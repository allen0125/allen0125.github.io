{"componentChunkName":"component---src-templates-blog-post-js","path":"/vps_ security/","result":{"data":{"site":{"siteMetadata":{"title":"Allen's Blog"}},"markdownRemark":{"id":"2bdbc408-3823-5f2d-ae3e-ca16affe1773","excerpt":"昨天去看了下我在海星云上不怎么用的那台VPS，然后发现了流量超出被暂停了，被暂停了是看不到每天流量进出口监控，所以我发了工单问了下是什么情况，大概就是3月3号的时候突然的VPS出口流量很多，估计是被用来做肉鸡然后去DDNS别人了吧。 客服在看了流量是别黑没的之后好心的给我加了400G…","html":"<p>昨天去看了下我在海星云上不怎么用的那台VPS，然后发现了流量超出被暂停了，被暂停了是看不到每天流量进出口监控，所以我发了工单问了下是什么情况，大概就是3月3号的时候突然的VPS出口流量很多，估计是被用来做肉鸡然后去DDNS别人了吧。</p>\n<p>客服在看了流量是别黑没的之后好心的给我加了400G，然后要求我在一个小时内解决掉被挂上的马。</p>\n<p>对于我这种运维渣渣来说，根本没有解决这种问题的经验，现在回头想下应该留一个快照之后研究用。没有了实战环境那就学着从多个方面来提升VPS的安全程度就好了。通过阅读资料我了解到了以下这些保证服务器安全的方法：</p>\n<p>1: SSH 相关安全\n2: 防火墙相关安全\n3: rootkit 相关安全</p>\n<p>在重新安装系统之后，我把本地的SSH也替换了一遍，之前是 RSA 的 SSH Key，现在换成了 ED25519 公、私钥更短，但是更加安全，是RSA安全性的10倍，更换了本地SSH Key之后我开始设置 VPS 上的SSH配置，SSH 配置修改了以下几部分</p>\n<p>1: 替换默认22端口，改为其它端口。\n2: 创建新用户，加入 sudo 用户组，用户密码用1Password生成保证唯一。\n3: ssh-copy-id 给新建的用户添加上 SSH 公钥\n4: 禁止root用户登录\n5: 3次密码失败等待，10次密码失败ban IP fail2ban</p>\n<p>完成SSH相关安全配置之后就开始搞防火墙\niptables的配置对我来说还挺麻烦的，所以我就用ufw来进行防火墙的配置了，ufw配置起来和各种云服务的防火墙配置感觉类似，allow端口或者deny端口就好了。配置防火墙需要注意的是一定要先把 SSH 的端口打开，不然忘记这个可真的就要翻车了。然后就是需要哪些端口再打开哪些端口，其他的一律禁止就好了。我现在就只打开了SSH的端口和80端口，毕竟是新装的系统，装了个nginx测试下防火墙的效果，并且nginx之后还是会用到的。</p>\n<p>rootkit是我刚从鸟哥的网站上了解到的内容，鸟哥网站上关于rootkit相关的内容其实有些旧了，看下了解下什么是rootkit，如何来应对就好，实际遇到问题的时候还是多参考官方手册就能解决掉绝大多数的问题。</p>\n<p>检查VPS当中是否有rootkit主要用RootKit Hunter这个软件，这个软件在使用之前一定要运行 rkhunter —propupd命令来更新软件md5等数据库信息，保证数据库信息最新，避免一些不必要的Warning。</p>\n<p>完成SSH、防火墙、rootkit相关安全配置之后其实服务器的安全程度就不错了，之后再注意及时打暴露的服务的补丁应该就可以了。</p>","frontmatter":{"title":"记录一次VPS被黑后长记心的过程","date":"March 16, 2020","description":"个人 VPS 安全"}}},"pageContext":{"slug":"/vps_ security/","previous":null,"next":{"fields":{"slug":"/python-face-recognition/"},"frontmatter":{"title":"《Python 人脸识别从入门到工程实践》阅读与实践笔记"}}}}}